# weather_compare

-------------------
СТРУКТУРА ПРОГРАММЫ
-------------------

1. При запуске сервера запускается: 
    а) Ожидание запроса
    б) Таймер
    
2. Ожидание запроса:    
    а) "/" - возвращается index.html
    б) "/remove" - очищается вся БД
    в) "/insert" - Запускается WEATHER - получает погоду из источников,
        расчитывает необходимые данные и сохраняет на сервер
    г) "/select" - Запускает SELECTALL - получает данные из БД,
        рассчитывает их, формирует ответ и отправляет во Frontend
    д) "/count" - Подсчет кол-ва записей в БД
    е) "/testCalculate" - Запускает CALCULATE - забирает данные из БД,
        рассчитывает погрешность и сохраняет
    ж) "/mongorequest" - прямой select запрос к БД
    
    
3. Таймер - каждые 5 минут проверяет не пришло ли время.
    а) В начале каждого часа запускает WEATHER - 
        получает погоду из источников, расчитывает необходимые
        данные и сохраняет на сервер
    б) В конце дня запускает CALCULATE - забирает данные из БД,
        рассчитывает погрешность и сохраняет
        
-------------------        
   ДАННЫЕ В БД
-------------------
    
    1. daykey - тип записи
        а) actual - актуальная погода, (почасовой)
        б) forecast - Прогноз с какого-то дня на несколько дней вперед (почасовой)
        в) predicted - Прогноз с какого-то дня несколько дней назад на сегодня (почасовой) 
        г) actualaverage - Усредненный прогноз на сегодня (суточный)
        д) forecastaverage - Усредненный прогноз на несколько дней вперед (суточный)
        е) deviation - рассчитанное отклонение в зависимости от источника и дня
    2. key - тип данных
        а) temp - температура
        б) text - текстовое описание
    3. value - сами данные
    4. afterday - дальность прогноза, для predicted и deviation - отрицательный
    5. year
    6. month
    7. day
    8. hour
    9. timestamp
    
    
-------------------
    MANIFEST
-------------------

    1. Каждый объект в manifest.list - источник
    2. Они имеют поля:
        а) name - название источника
        б) url - сайт с которого забираются данные
        в) periodic - брать только четные или не четные записи (odd)
        г) params - параметры для поиска данных, 
            может быть объектом или набором объектов с разными url
             1. now_text - актуальное текстовое отражение
             2. now_teьз - актуальное цифровое отражение
             3. day_text - прогнозируемое текстовое отражение
             4. day_temp - прогнозируемое цифровое отражение
                Эти параметры представляют собой JQuery теги,
                по которым можно найти нужные данные в нужном виде
             5. firstNumber - с какого номера записывать в БД,
                нужно если данные находятся на нескольких различных страницах,
                но идут подряд